---
title: "2-exploration"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE}
# load packages
library(tidyverse)  # tidyverse
library(ggrepel)    # for scatter plot point labels
library(kableExtra) # for printing tables
library(cowplot)    # for side by side plots
# raincloud plots
if (!require(remotes)) {
  install.packages("remotes")
}
remotes::install_github('jorvlan/raincloudplots')

library(raincloudplots)
library(dplyr)
library(readr)
source("~/pregnancy-weight-gain-final-project/code/R_rainclouds.R")
```

```{r}
# load cleaned data
pdiet_data = read.csv("~/pregnancy-weight-gain-final-project/data/clean/pregnancy_data.csv")
```

```{r}
# calculate median weight gain
median_weight_gain = pdiet_data %>%
  summarise(median(pregnancy_weight_gain)) %>%
  pull()

# create histogram of weight gain during pregnancy
hist = pdiet_data %>%
  ggplot(aes(x = pregnancy_weight_gain)) + 
  geom_histogram() +
  geom_vline(xintercept = median_weight_gain,
             linetype = "dashed") +
  labs(x = "Weight gain during pregnancy", 
       y = "Number of women") +
  theme_classic()

# save
ggsave(filename = "~/pregnancy-weight-gain-final-project/results/weight-gain-hist.png", 
       plot = hist, 
       device = "png", 
       width = 7, 
       height = 4)

```

```{r}
# raincloud of weight gain vs race
raincloudRacePlot <- ggplot(pdiet_data, aes(x = mother_race_ethnicity, y = pregnancy_weight_gain, fill = mother_race_ethnicity)) +
  geom_flat_violin(aes(fill = mother_race_ethnicity),position = position_nudge(x = .2, y = 0), adjust = 1.5, trim = FALSE, alpha = .5, colour = NA)+
  geom_point(aes(x = mother_race_ethnicity, y = pregnancy_weight_gain, color = mother_race_ethnicity),position = position_jitter(width = .15, height = 0), size = 1, shape = 20)+
  geom_boxplot(aes(x = mother_race_ethnicity, y = pregnancy_weight_gain, fill = mother_race_ethnicity),outlier.shape = NA, alpha = .5, width = .1, colour = "black")+
  scale_colour_brewer(palette = "Set1")+
  scale_fill_brewer(palette = "Set1")+ theme_classic() + labs(x = "race/ethnicity", y = "weight gain during pregnancy") + 
  guides(x = guide_axis(n.dodge = 2))
raincloudRacePlot = raincloudRacePlot + labs(fill="race/ethnicity")

# save
ggsave(filename = "~/pregnancy-weight-gain-final-project/results/raincloud-race.png", 
       plot = raincloudRacePlot, 
       device = "png", 
       width = 7, 
       height = 4)
```

```{r}
# scatter plots of weight gain vs age, bmi, poverty/income ratio

```

```{r, warning=FALSE}
# raincloud plot of weight gain vs education
raincloudEduPlot <- ggplot(pdiet_data, aes(x = mother_education, y = pregnancy_weight_gain, fill = mother_education)) +
  geom_flat_violin(aes(fill = mother_education),position = position_nudge(x = .2, y = 0), adjust = 1.5, trim = FALSE, alpha = .5, colour = NA)+
  geom_point(aes(x = mother_education, y = pregnancy_weight_gain, color = mother_education),position = position_jitter(width = .15, height = 0), size = 1, shape = 20)+
  geom_boxplot(aes(x = mother_education, y = pregnancy_weight_gain, fill = mother_education),outlier.shape = NA, alpha = .5, width = .1, colour = "black")+
  scale_colour_brewer(palette = "Set1")+
  scale_fill_brewer(palette = "Set1")+ theme_classic() + labs(x = "education level", y = "weight gain during pregnancy") +
  guides(x = guide_axis(angle = 90))

# save
ggsave(filename = "~/pregnancy-weight-gain-final-project/results/raincloud-education.png", 
       plot = raincloudEduPlot, 
       device = "png", 
       width = 7, 
       height = 4)

```